<!DOCTYPE html>
<html>
  <head>
    <div id="screen">
      <img id="screen-image" src="plains_east.png" />
    </div>
  </head>
  <body>
    <button id="left" onclick="goLeft ()">Left</button>
    <button id="right" onclick="goRight ()">Right</button>
    <button id="forward" onclick="goForward ()">Go forward</button>
    <button id="lantern" onclick="lantern.use()">Lantern</button>
    <button id="compass" onclick="compass.use()">Compass</button>

    <p id="description-text"></p>

    <style>
      #screen {
        position: absolute;
        top: 5%;
        left: 20%;
        width: 60%;
        height: 70%;
        border: 2px solid whitesmoke;
      }
      #screen-image {
        position: absolute;
        top: 0%;
        left: 0%;
        width: 100%;
        height: 100%;
      }
      #left {
        position: absolute;
        top: 80%;
        left: 40%;
      }
      #right {
        position: absolute;
        top: 80%;
        right: 45%;
      }
      #forward {
        position: absolute;
        top: 80%;
        left: 45%;
      }
      #description-text {
        position: absolute;
        top: 85%;
      }
      body {
        font-family: arial;
        background-color: black;
        color: white;
        font-size: 20px;
      }
    </style>
    <script>
      let MAP_SIZE = 13;

      let plainTile = function (iX, iY) {
        this.x = iX;
        this.y = iY;
        this.westImage = "plains.png";
        this.northImage = "plains.png";
        this.southImage = "plains.png";
        this.eastImage = "plains_east.png";
      };
      let forestTile = function (iX, iY) {
        this.x = iX;
        this.y = iY;
        this.westImage = "forest.png";
        this.northImage = "forest.png";
        this.southImage = "forest.png";
        this.eastImage = "forest_east.png";
      };

      var rooms = [
        new forestTile (6, 8), new plainTile (7, 8), new plainTile (8, 8), new plainTile (9, 8), new plainTile (10, 8),
        new forestTile (6, 9), new plainTile (7, 9), new plainTile (8, 9), new plainTile (9, 9), new plainTile (10, 9),
        new forestTile (6, 10), new forestTile (7, 10), new forestTile (8, 10), new plainTile (9, 10), new plainTile (10, 10),

      ];
      var torches = [
        { x: 9, y: 9, isLit: false },
        { x: 10, y: 8, isLit: false },
        { x: 5, y: 6, isLit: false },
        { x: 6, y: 7, isLit: false },
        { x: 9, y: 11, isLit: false },
        { x: 4, y: 11, isLit: false },
      ];

      var direction = "east";
      var x = 7,
        y = 9;
      let totalTorchesLit = 0;
      let lanternLight = 11; // -- amount of tiles the player can walk until lantern runs out
      let maxLanternLight = 11;

      function getIndexFromPosition(x, y) {
        for (var i = 0; i < rooms.length; i++) {
          if (x === rooms[i].x && y === rooms[i].y) {
            return i;
          }
        }
      }

      function getTorchIndexFromPosition(x, y) {
        let NONE_FOUND = -1;
        for (let i = 0; i < torches.length; i++) {
          if (x === torches[i].x && y === torches[i].y) {
            return i;
          }
        }

        return NONE_FOUND;
      }

      function goLeft() {
        if (direction === "east") {
          direction = "north";
        } else if (direction === "north") {
          direction = "west";
        } else if (direction === "west") {
          direction = "south";
        } else if (direction === "south") {
          direction = "east";
        }
        updateImage();
      }
      function goRight() {
        if (direction === "west") {
          direction = "north";
        } else if (direction === "north") {
          direction = "east";
        } else if (direction === "east") {
          direction = "south";
        } else if (direction === "south") {
          direction = "west";
        }
        updateImage();
      }

      function goForward() {
        if (direction === "west" && x > 0) {
          x--;
        } else if (direction === "north" && y > 0) {
          y--;
        } else if (direction === "east" && x < MAP_SIZE - 1) {
          x++;
        } else if (direction === "south" && y < MAP_SIZE - 1) {
          y++;
        }
        console.log(x + "," + y + " " + lanternLight);
        updateImage();

        let torchIndex = getTorchIndexFromPosition(x, y);
        if (torchIndex !== -1) {
          if (torches[torchIndex].isLit) {
            document.getElementById("description-text").innerHTML =
              "There is an lit torch here. You can relight your lantern.";
          } else {
            document.getElementById("description-text").innerHTML =
              "There is an unlit torch here. Use your lantern to light it!";
          }
        }
        if (lanternLight > 0) {
          lanternLight--;
        }
      }
      function updateImage() {
        let roomIndex = 0;
        if (lanternLight > 0) {
          if (direction === "west") {
            if (x === 0) {
              document.getElementById("screen-image").src =
              "cliff.png";
            } else {
              roomIndex = getIndexFromPosition (x - 1, y);
              document.getElementById("screen-image").src =
              rooms[roomIndex].westImage;
            }
          } else if (direction === "north") {
            if (y === 0) {
              document.getElementById("screen-image").src =
              "cliff.png";
            } else {
              roomIndex = getIndexFromPosition (x, y - 1);
              document.getElementById("screen-image").src =
              rooms[roomIndex].northImage;
            }

          } else if (direction === "east") {
            if (x === MAP_SIZE - 1) {
              document.getElementById("screen-image").src =
              "cliff.png";
            } else {
              roomIndex = getIndexFromPosition (x + 1, y);
              document.getElementById("screen-image").src =
              rooms[roomIndex].eastImage;
            }
          } else if (direction === "south") {
            if (y === MAP_SIZE - 1) {
              document.getElementById("screen-image").src =
              "cliff.png";
            } else {
              roomIndex = getIndexFromPosition (x, y + 1);
              document.getElementById("screen-image").src =
              rooms[roomIndex].southImage;
            }
          }
        } else {
          document.getElementById("screen-image").src = "complete-dark.png";
          document.getElementById("description-text").innerHTML =
            "Your lantern has run out of light. Find a torch to relight it!";
        }
      }

      let Item = function (sName, sDescription, fUse) {
        this.name = sName;
        this.description = sDescription;
        this.use = fUse;
      };

      let compass = new Item("Compass", "An old compass.", () => {
        document.getElementById("description-text").innerHTML =
          "Your compass reads: " + direction;
      });
      let lantern = new Item("Lantern", "Your trusty light.", () => {
        let torchIndex = getTorchIndexFromPosition(x, y);

        if (torchIndex !== -1) {
          if (!torches[torchIndex].isLit && lanternLight > 0) {
            torches[torchIndex].isLit = true;
            totalTorchesLit++;
            document.getElementById("description-text").innerHTML =
              "New torch found!! Total torches lit: " + totalTorchesLit;
          } else {
            lanternLight = maxLanternLight;
            document.getElementById("description-text").innerHTML =
              "Relit lantern at torch!";
            updateImage();
          }
        } else {
          document.getElementById("description-text").innerHTML =
            "You check the lantern. Light left: " + lanternLight;
        }
      });
    </script>
  </body>
</html>
